{
  "hash": "3be52e0c6f16e4243a21d63ff333c64a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Rope Bridge\"\nformat: html\ndate: \"2022-12-09\"\ndraft: true\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(mistlecode)\nlibrary(S7)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndt <-\n  fread(\"input2.txt\") |>\n  `colnames<-`(c(\"dir\", \"mag\")) |>\n  expand_directions()\n```\n:::\n\n\n\n\n\n## Part 1\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npythagoras <- function(x1, x2) {\n  sqrt(x1^2 + x2^2)\n}\n\nend <-\n  new_class(\n    \"end\",\n    properties = list(\n      row = class_numeric,\n      col = class_numeric\n    )\n  )\n\nrope <- \n  new_class(\n    \"rope\",\n    properties = list(\n      head = end,\n      tail = end,\n      visited = class_list\n    ),\n    validator = function(self) {\n      if(\n        pythagoras(self@head@row, self@tail@row) > sqrt(2) | \n        pythagoras(self@head@col, self@tail@col) > sqrt(2)\n        ) {\n        \"@head cannot be farther than `sqrt(2)` from @tail\"\n      }\n    }\n  )\n\nmove <- new_generic(\"move\", \"x\")\n\nmethod(move, end) <- function(x, dir) {\n  if (dir == \"R\") {\n    x@col <- x@col + 1\n  } else if (dir == \"U\") {\n    x@row <- x@row + 1\n  } else if (dir == \"L\") {\n    x@col <- x@col - 1\n  } else if (dir == \"D\") {\n    x@row <- x@row - 1\n  }\n  x\n}\n\nmethod(move, rope) <- function(x, dir) {\n  valid_eventually(x, function(o) {\n    he <- move(x@head, dir)\n    ta <- x@tail\n    pr <- pythagoras(he@row, ta@row)\n    if (pr >= sqrt(2)) {\n      ta <- x@head\n    } else if (pr > sqrt(2)) {\n      ta <- x@head\n    } else if (pr == 2) {\n      ta <- x@head\n    } else if (pr == 0) {\n      ta\n    }\n    x@head <- he\n    x@tail <- ta\n    x\n  })\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsize <- \n  dt |>\n  table() |>\n  max() |>\n  prod(2) |>\n  sum(1)\nmidpoint <- ceiling(size / 2)\n\nrope <- \n  list(\n    head = list(\"row\" = midpoint, \"col\" = midpoint),\n    tail = list(\"row\" = midpoint, \"col\" = midpoint),\n    visited = list()\n  )\n\ncheck <- function(head, tail) {\n  dist <- \n    sqrt(\n      (abs(head$col) - abs(tail$col))^2 + (abs(head$row) - abs(tail$row))^2\n    )\n  case_when(\n    dist < 2 ~ \"zero\",\n    dist == 2 ~ \"near\",\n    dist > 2 ~ \"far\"\n  )\n}\n\nmove_end <- function(end, dir) {\n  if (dir == \"R\") {\n    end$col <- end$col + 1\n  } else if (dir == \"U\") {\n    end$row <- end$row + 1\n  } else if (dir == \"L\") {\n    end$col <- end$col - 1\n  } else if (dir == \"D\") {\n    end$row <- end$row - 1\n  }\n  end\n}\n\nmove_rope <- function(rope, dir) {\n  nh <- rope$head\n  nt <- rope$tail\n  \n  nh <- move_end(nh, dir)\n  q <- check(nh, nt)\n  \n  if (q == \"zero\") {\n    print(\"no move needed\")\n  } else if (q == \"near\") {\n    nt <- move_end(nt, dir)\n  } else if (q == \"far\") {\n    dcol <- abs(nh$col - nt$col)\n    drow <- abs(nh$row - nt$row)\n    \n    if (dcol == 2 & drow == 1) {\n      nt$col <- mean(nh$col + nt$col)\n      nt$row <- ceiling(mean(nh$row + nt$row))\n    } else {\n      nt$row <- mean(nh$row + nt$row)\n      nt$col <- ceiling(mean(nh$col + nt$col))\n    }\n  }\n  \n  rope$head <- nh\n  rope$tail <- nt\n  rope$visited <- append(rope$visited, list(c(nt$row, nt$col)))\n  rope\n}\n\nfor (d in dt) {\n  rope <- move_rope(rope, d)\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"no move needed\"\n[1] \"no move needed\"\n```\n\n\n:::\n\n```{.r .cell-code}\nrope$visited |>\n  unique() |>\n  map(\\(x) data.frame(r = x[1], c = x[2])) |>\n  bind_rows() |>\n  mutate(id = row_number()) |>\n  ggplot() +\n  geom_point(aes(x = c, y = r, size = id, color = id)) +\n  ylim(c(11, 15)) +\n  xlim(c(11, 16))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 19 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](2022-09v2_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}