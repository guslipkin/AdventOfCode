{
  "hash": "1c8ffa4fde76d2d208acdfed8e5c0eb0",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"The Treachery of Whales\"\nformat: html\ndate: \"2021-12-07\"\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(stringr)\nlibrary(tidyverse)\nlibrary(data.table)\n\ndt <- as.numeric(data.table::fread(\"input.txt\", header = FALSE)[1])\n```\n:::\n\n\n\n\n## Part 1\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndt2 <- data.table(\"start\" = dt)\ns <- c()\nfor(i in -max(dt):max(dt)) {\n  dt2 <- data.table(\"start\" = dt)\n  dt2[, mean := floor(mean(start))][, diff := abs(start - mean + i)]\n  s <- append(s, sum(dt2$diff))\n}\nmin(s)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 342730\n```\n\n\n:::\n:::\n\n\n\n\n## Part 2\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndt2 <- data.table(\"start\" = dt)\ns <- c()\n\nfor(i in -max(dt):max(dt)) {\n  dt2 <- data.table(\"start\" = dt)\n  dt2[, mean := floor(mean(start))]\n  for(r in 1:nrow(dt2))\n    dt2$diff[r] <- sum(1:(abs(dt2$start[r] - dt2$mean[r] - i)))\n  s <- append(s, sum(dt2$diff))\n}\nmin(s)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 92335207\n```\n\n\n:::\n:::\n\n\n\n\n## Speed Edition\n\nPlease don't look at this. It's embarrassing.\n\nI only did one rep because my first try is too slow.\n\n### Fastest solution\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(stringr)\nlibrary(tidyverse)\nlibrary(data.table)\n\n\ndt <- as.numeric(data.table::fread(\"input.txt\", header = FALSE)[1])\n# part 1\ns <- max(dt) ^ length(dt)\nfor (i in-ceiling(max(dt) / 2):ceiling(max(dt) / 2)) {\n  dt2 <-\n    data.table(\"start\" = dt)[, mean := floor(mean(start))][, diff := abs(start - mean - i)]\n  dtDiff <- sum(dt2$diff)\n  s <- data.table::fifelse(dtDiff < s, dtDiff, s)\n}\ns <- c(s)\n\n# part 2\ncSum <- function(y) {\n  eval(parse(text = y))\n}\ndt2 <- data.table(\"start\" = dt)\ndt2[, mean := mean(dt2$start, na.rm = TRUE)]\ndt2$abs <- abs(dt2$start - dt2$mean)\ndt2$meanC <- ceiling(dt2$mean)\ndt2$meanF <- floor(dt2$mean)\ndt2$absC <- abs(dt2$start - dt2$meanC)\ndt2$absF <- abs(dt2$start - dt2$meanF)\ndt2$diffC <- sapply(paste0(\"sum(1:\", dt2$absC, \")\"), cSum)\ndt2$diffF <- sapply(paste0(\"sum(1:\", dt2$absF, \")\"), cSum)\ns <- min(sum(dt2$diffC), sum(dt2$diffF))\n```\n:::\n\n\n\n\n### Benchmark\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbench <- rbenchmark::benchmark(\n  \"first\" = {\n    library(stringr)\n    library(tidyverse)\n    library(data.table)\n    dt <-\n      as.numeric(data.table::fread(\"input.txt\", header = FALSE)[1])\n    # part 1\n    dt2 <- data.table(\"start\" = dt)\n    s <- c()\n    for (i in-max(dt):max(dt)) {\n      dt2 <- data.table(\"start\" = dt)\n      dt2[, mean := floor(mean(start))][, diff := abs(start - mean + i)]\n      s <- append(s, sum(dt2$diff))\n    }\n    s <- min(s)\n    \n    # part 2\n    dt2 <- data.table(\"start\" = dt)\n    s <- c()\n    \n    for (i in-max(dt):max(dt)) {\n      dt2 <- data.table(\"start\" = dt)\n      dt2[, mean := floor(mean(start))]\n      for (r in 1:nrow(dt2))\n        dt2$diff[r] <- sum(1:(abs(dt2$start[r] - dt2$mean[r] - i)))\n      s <- append(s, sum(dt2$diff))\n    }\n    s <- min(s)\n  },\n  \"second\" = {\n    library(stringr)\n    library(tidyverse)\n    library(data.table)\n    dt <-\n      as.numeric(data.table::fread(\"input.txt\", header = FALSE)[1])\n    # part 1\n    s <- max(dt) ^ length(dt)\n    for (i in-ceiling(max(dt) / 2):ceiling(max(dt) / 2)) {\n      dt2 <-\n        data.table(\"start\" = dt)[, mean := floor(mean(start))][, diff := abs(start - mean - i)]\n      dtDiff <- sum(dt2$diff)\n      s <- data.table::fifelse(dtDiff < s, dtDiff, s)\n    }\n    s <- c(s)\n    \n    cSum <- function(y) {\n      eval(parse(text = y))\n    }\n    dt2 <- data.table(\"start\" = dt)\n    dt2[, mean := mean(dt2$start, na.rm = TRUE)]\n    dt2$abs <- abs(dt2$start - dt2$mean)\n    dt2$meanC <- ceiling(dt2$mean)\n    dt2$meanF <- floor(dt2$mean)\n    dt2$absC <- abs(dt2$start - dt2$meanC)\n    dt2$absF <- abs(dt2$start - dt2$meanF)\n    dt2$diffC <- sapply(paste0(\"sum(1:\", dt2$absC, \")\"), cSum)\n    dt2$diffF <- sapply(paste0(\"sum(1:\", dt2$absF, \")\"), cSum)\n    min(sum(dt2$diffC), sum(dt2$diffF))\n  },\n  replications = 1,\n  columns = 1:5,\n  order = \"user.self\"\n)\n\nbench$per <- bench$user.self / bench$replications\nbench\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    test replications user.self sys.self elapsed     per\n2 second            1     1.028    0.006   1.034   1.028\n1  first            1   162.110    0.103 162.630 162.110\n```\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}