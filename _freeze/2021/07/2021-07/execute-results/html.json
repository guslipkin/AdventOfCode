{
  "hash": "121254c84beb108fd09ee91d8f609044",
  "result": {
    "markdown": "---\ntitle: \"2021-07: The Treachery of Whales\"\nformat: html\n---\n\n::: {.cell hash='2021-07_cache/html/unnamed-chunk-1_e2c1ee9d1577e5fa6383dedab7529117'}\n\n```{.r .cell-code}\nlibrary(stringr)\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.4.0      ✔ purrr   0.3.5 \n✔ tibble  3.1.8      ✔ dplyr   1.0.10\n✔ tidyr   1.2.1      ✔ forcats 0.5.2 \n✔ readr   2.1.3      \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n```\n:::\n\n```{.r .cell-code}\nlibrary(data.table)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'data.table'\n\nThe following objects are masked from 'package:dplyr':\n\n    between, first, last\n\nThe following object is masked from 'package:purrr':\n\n    transpose\n```\n:::\n\n```{.r .cell-code}\ndt <- as.numeric(data.table::fread(\"input.txt\", header = FALSE)[1])\n```\n:::\n\n\n## Part 1\n\n\n::: {.cell hash='2021-07_cache/html/unnamed-chunk-2_67e41f0977f4f547f84480f72c567495'}\n\n```{.r .cell-code}\ndt2 <- data.table(\"start\" = dt)\ns <- c()\nfor(i in -max(dt):max(dt)) {\n  dt2 <- data.table(\"start\" = dt)\n  dt2[, mean := floor(mean(start))][, diff := abs(start - mean + i)]\n  s <- append(s, sum(dt2$diff))\n}\nmin(s)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 342730\n```\n:::\n:::\n\n\n## Part 2\n\n\n::: {.cell hash='2021-07_cache/html/unnamed-chunk-3_9da85c9db052fe5588273e64d733f006'}\n\n```{.r .cell-code}\ndt2 <- data.table(\"start\" = dt)\ns <- c()\n\nfor(i in -max(dt):max(dt)) {\n  dt2 <- data.table(\"start\" = dt)\n  dt2[, mean := floor(mean(start))]\n  for(r in 1:nrow(dt2))\n    dt2$diff[r] <- sum(1:(abs(dt2$start[r] - dt2$mean[r] - i)))\n  s <- append(s, sum(dt2$diff))\n}\nmin(s)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 92335207\n```\n:::\n:::\n\n\n## Speed Edition\n\nPlease don't look at this. It's embarrassing.\n\nI only did one rep because my first try is too slow.\n\n### Fastest solution\n\n\n::: {.cell hash='2021-07_cache/html/unnamed-chunk-4_a33a47643098636ee694ce503e186b10'}\n\n```{.r .cell-code}\nlibrary(stringr)\nlibrary(tidyverse)\nlibrary(data.table)\n\n\ndt <- as.numeric(data.table::fread(\"input.txt\", header = FALSE)[1])\n# part 1\ns <- max(dt) ^ length(dt)\nfor (i in-ceiling(max(dt) / 2):ceiling(max(dt) / 2)) {\n  dt2 <-\n    data.table(\"start\" = dt)[, mean := floor(mean(start))][, diff := abs(start - mean - i)]\n  dtDiff <- sum(dt2$diff)\n  s <- data.table::fifelse(dtDiff < s, dtDiff, s)\n}\ns <- c(s)\n\n# part 2\ncSum <- function(y) {\n  eval(parse(text = y))\n}\ndt2 <- data.table(\"start\" = dt)\ndt2[, mean := mean(dt2$start, na.rm = TRUE)]\ndt2$abs <- abs(dt2$start - dt2$mean)\ndt2$meanC <- ceiling(dt2$mean)\ndt2$meanF <- floor(dt2$mean)\ndt2$absC <- abs(dt2$start - dt2$meanC)\ndt2$absF <- abs(dt2$start - dt2$meanF)\ndt2$diffC <- sapply(paste0(\"sum(1:\", dt2$absC, \")\"), cSum)\ndt2$diffF <- sapply(paste0(\"sum(1:\", dt2$absF, \")\"), cSum)\ns <- min(sum(dt2$diffC), sum(dt2$diffF))\n```\n:::\n\n\n### Benchmark\n\n\n::: {.cell hash='2021-07_cache/html/unnamed-chunk-5_64d342930ea087b1ad1c0e1ac8bdfff4'}\n\n```{.r .cell-code}\nbench <- rbenchmark::benchmark(\n  \"first\" = {\n    library(stringr)\n    library(tidyverse)\n    library(data.table)\n    dt <-\n      as.numeric(data.table::fread(\"input.txt\", header = FALSE)[1])\n    # part 1\n    dt2 <- data.table(\"start\" = dt)\n    s <- c()\n    for (i in-max(dt):max(dt)) {\n      dt2 <- data.table(\"start\" = dt)\n      dt2[, mean := floor(mean(start))][, diff := abs(start - mean + i)]\n      s <- append(s, sum(dt2$diff))\n    }\n    s <- min(s)\n    \n    # part 2\n    dt2 <- data.table(\"start\" = dt)\n    s <- c()\n    \n    for (i in-max(dt):max(dt)) {\n      dt2 <- data.table(\"start\" = dt)\n      dt2[, mean := floor(mean(start))]\n      for (r in 1:nrow(dt2))\n        dt2$diff[r] <- sum(1:(abs(dt2$start[r] - dt2$mean[r] - i)))\n      s <- append(s, sum(dt2$diff))\n    }\n    s <- min(s)\n  },\n  \"second\" = {\n    library(stringr)\n    library(tidyverse)\n    library(data.table)\n    dt <-\n      as.numeric(data.table::fread(\"input.txt\", header = FALSE)[1])\n    # part 1\n    s <- max(dt) ^ length(dt)\n    for (i in-ceiling(max(dt) / 2):ceiling(max(dt) / 2)) {\n      dt2 <-\n        data.table(\"start\" = dt)[, mean := floor(mean(start))][, diff := abs(start - mean - i)]\n      dtDiff <- sum(dt2$diff)\n      s <- data.table::fifelse(dtDiff < s, dtDiff, s)\n    }\n    s <- c(s)\n    \n    cSum <- function(y) {\n      eval(parse(text = y))\n    }\n    dt2 <- data.table(\"start\" = dt)\n    dt2[, mean := mean(dt2$start, na.rm = TRUE)]\n    dt2$abs <- abs(dt2$start - dt2$mean)\n    dt2$meanC <- ceiling(dt2$mean)\n    dt2$meanF <- floor(dt2$mean)\n    dt2$absC <- abs(dt2$start - dt2$meanC)\n    dt2$absF <- abs(dt2$start - dt2$meanF)\n    dt2$diffC <- sapply(paste0(\"sum(1:\", dt2$absC, \")\"), cSum)\n    dt2$diffF <- sapply(paste0(\"sum(1:\", dt2$absF, \")\"), cSum)\n    min(sum(dt2$diffC), sum(dt2$diffF))\n  },\n  replications = 1,\n  columns = 1:5,\n  order = \"user.self\"\n)\n\nbench$per <- bench$user.self / bench$replications\nbench\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n    test replications user.self sys.self elapsed     per\n2 second            1     0.863    0.005   0.870   0.863\n1  first            1   125.937   11.166 138.154 125.937\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}